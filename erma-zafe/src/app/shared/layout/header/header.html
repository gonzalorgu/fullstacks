<header class="header" [class.scrolled]="scrolled()">
  <div class="container">
    <a routerLink="/home" aria-label="Ir al inicio" class="brand-link">
      <span class="logo-text brand-script">Erma Zafe</span>
    </a>

    <!-- Navegación desktop -->
    <nav class="nav desktop-nav">
      <a routerLink="/home" routerLinkActive="active" [routerLinkActiveOptions]="{exact:true}">Inicio</a>
      <a routerLink="/catalogo" routerLinkActive="active">Catálogo</a>

      @if (isLoggedIn()) {
        <a routerLink="/mis-alquiler" routerLinkActive="active">Mis alquileres</a>
        <!-- Eliminada enlace a "Mis Compras" -->
        <a routerLink="/perfil" routerLinkActive="active">Mi perfil</a>
      }
    </nav>

    <!-- Usuario desktop -->
    <div class="desktop-user">
      <!-- ✅ CARRITO SIEMPRE VISIBLE (fuera del if) -->
      <button class="cart-btn" (click)="goToCart()" title="Mi carrito">
        <svg data-icon="bag-1" width="40" height="40" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" fill="currentColor">
          <path d="M11 44q-1.2 0-2.1-.9Q8 42.2 8 41V15q0-1.2.9-2.1.9-.9 2.1-.9h5.5v-.5q0-3.15 2.175-5.325Q20.85 4 24 4q3.15 0 5.325 2.175Q31.5 8.35 31.5 11.5v.5H37q1.2 0 2.1.9.9.9.9 2.1v26q0 1.2-.9 2.1-.9.9-2.1.9Zm0-3h26V15h-5.5v4.5q0 .65-.425 1.075Q30.65 21 30 21q-.65 0-1.075-.425-.425-.425-.425-1.075V15h-9v4.5q0 .65-.425 1.075Q18.65 21 18 21q-.65 0-1.075-.425-.425-.425-.425-1.075V15H11v26Zm8.5-29h9v-.5q0-1.9-1.3-3.2Q25.9 7 24 7q-1.9 0-3.2 1.3-1.3 1.3-1.3 3.2ZM11 41V15v26Z"></path>
        </svg>
        @if (cartCount() > 0) {
          <span class="cart-badge">{{ cartCount() }}</span>
        }
      </button>

      @if (isLoggedIn()) {
        <!-- Menu Usuario -->
        <div class="user-menu">
          <button class="user-btn" (click)="toggleUserMenu()">
            <img src="assets/icons/profile-circle-svgrepo-com.svg" alt="Usuario" class="user-avatar">
            <span>{{ userName() }}</span>
          </button>

          @if (showUserMenu()) {
            <div class="user-dropdown">
              <a routerLink="/perfil" (click)="closeUserMenu()">
                <img src="assets/icons/profile-circle-svgrepo-com.svg" alt="Perfil" class="menu-icon">
                Mi Perfil
              </a>
              <a routerLink="/mis-alquiler" (click)="closeUserMenu()">
                <img src="assets/icons/woman-fashion-clothes-svgrepo-com.svg" alt="Alquileres" class="menu-icon">
                Mis Alquileres
              </a>
              <!-- Eliminada link a "Mis Compras" -->
              <div class="divider"></div>
              <button (click)="logout()">
                <img src="assets/icons/exit-svgrepo-com.svg" alt="Salir" class="menu-icon">
                Cerrar Sesión
              </button>
            </div>
          }
        </div>
      } @else {
        <a routerLink="/login" class="btn-login">Iniciar sesión</a>
      }
    </div>

    <!-- Botón hamburguesa -->
    <button class="menu-toggle" (click)="toggleMobileMenu()" aria-label="Menú">
      <span [class.open]="showMobileMenu()"></span>
      <span [class.open]="showMobileMenu()"></span>
      <span [class.open]="showMobileMenu()"></span>
    </button>
  </div>
</header>

<!-- Menú móvil -->
@if (showMobileMenu()) {
  <div class="mobile-menu-fullscreen">
    <nav class="mobile-nav">
      <a routerLink="/home" routerLinkActive="active" [routerLinkActiveOptions]="{exact:true}" (click)="closeMobileMenu()">
        Inicio
      </a>
      <a routerLink="/catalogo" routerLinkActive="active" (click)="closeMobileMenu()">
        Catálogo
      </a>

      <!-- ✅ CARRITO MÓVIL SIEMPRE VISIBLE -->
      <a routerLink="/carrito" (click)="closeMobileMenu()" class="cart-link-mobile">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 2L7 6H3L6 18H18L21 6H17L15 2H9Z"/>
          <circle cx="9" cy="21" r="1"/>
          <circle cx="17" cy="21" r="1"/>
        </svg>
        Mi Carrito
        @if (cartCount() > 0) {
          <span class="cart-badge-mobile">({{ cartCount() }})</span>
        }
      </a>

      @if (isLoggedIn()) {
        <a routerLink="/mis-alquiler" routerLinkActive="active" (click)="closeMobileMenu()">
          Mis alquileres
        </a>
        <!-- Eliminada link a "Mis Compras" -->
        <a routerLink="/perfil" routerLinkActive="active" (click)="closeMobileMenu()">
          Mi perfil
        </a>
        <div class="divider"></div>
        <button (click)="logout()" class="logout-btn">
          Cerrar Sesión
        </button>
      } @else {
        <a routerLink="/login" (click)="closeMobileMenu()" class="login-btn">
          Iniciar sesión
        </a>
      }
    </nav>
  </div>
}
